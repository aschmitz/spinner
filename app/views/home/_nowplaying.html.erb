<%
played_song = PlayedSong.order(played_at: :desc).where('played_at > ?', 1.hour.ago).first

unless played_song %>
Nothing.
<% else
  track = played_song.track %>
  <% if (img = track.image) %>
    <%= image_tag img, alt: track.title, style: 'width: 256px; height: auto;' %><br>
  <% end %>
  "<%= track.title %>"
  (<%= length_text(track.details['length']) %>)
  by <%= artists_to_text(track.details['artists']) %>
  <% if track.details['album'] %>
    on <i><%= album_link(track.details['album']) %></i>
  <% end %><br>
  Played by <%= user_display_name(played_song.user) %>
  <% if played_song.user == current_user %>
    (you can
      <%= button_to 'skip your own song', {
        controller: 'home',
        action: 'skip_my_song',
      }, form_class: 'form-inline' %>)
  <% end %><br>
  <% if (rating = Rating.find_by(user: current_user, track: track)) %>
    You said this track was <%= Rating::SCORE_TO_TEXT[rating.score] %>. 
    <%= button_to 'Take it back?', rating, method: 'delete', form_class: 'form-inline' %>
  <% else %>
    How is it?
    <% (-1..1).each do |score| %>
      <%= button_to Rating::SCORE_TO_TEXT[score], {
        controller: 'rating',
        action: 'create',
        track_id: track.id,
        score: score,
      }, form_class: 'form-inline' %>
    <% end %>
  <% end %>
<% end %>
